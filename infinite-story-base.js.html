

<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>JSDoc: infinite-story-base.js</title>

    <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="./build/entry.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link href="https://fonts.googleapis.com/css?family=Muli:100,400,700|Oswald:300|Inconsolata,700" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
    <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
    <link type="text/css" rel="stylesheet" href="styles/app.min.css">
</head>

<body>
    <div id="stickyNavbarOverlay"></div>
    <div class="top-navbar">
        <div class="container">
            <nav class="navbar" role="navigation" aria-label="main navigation">
                <div class="navbar-brand">
                    
                     
                        <h1 class="navbar-item">Quintype Components</h1>
                    
                    <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
                        <span aria-hidden="true"></span>
                        <span aria-hidden="true"></span>
                        <span aria-hidden="true"></span>
                    </a>
                </div>
                 
                <div class="navbar-menu">
                    <div class="navbar-end">
                    
                        <div class="navbar-item">
                            <a href="https://github.com/quintype/quintype-node-components" target="_blank">Github</a>
                        </div>
                    
                    </div>
                </div>
                
            </nav>
        </div>
    </div>
    <div class="container">
        <div class="columns">
            <div class="column is-3" id="sidebarNav">
                <div class="sidebar">
                    <nav>
                        <h2><a href="index.html">Home</a></h2><div class="category"><h3>Tutorials</h3><ul><li><a href="tutorial-using-responsive-image.html">Using ResponsiveImage</a></li></ul></div><div class="category"><h2>Ads</h2><h3>Components</h3><ul><li><a href="AdbutlerAd.html">AdbutlerAd</a></li></ul><h3>Global</h3><ul><li><a href="global.html#createDfpAdComponent">createDfpAdComponent</a></li></ul></div><div class="category"><h2>Collection Page</h2><h3>Components</h3><ul><li><a href="Collection.html">Collection</a></li><li><a href="LazyCollection.html">LazyCollection</a></li><li><a href="LoadMoreCollectionStories.html">LoadMoreCollectionStories</a></li><li><a href="LoadMoreStoriesBase.html">LoadMoreStoriesBase</a></li></ul><h3>Global</h3><ul><li><a href="global.html#collectionToStories">collectionToStories</a></li><li><a href="global.html#wrapCollectionLayout">wrapCollectionLayout</a></li></ul></div><div class="category"><h2>Header</h2><h3>Components</h3><ul><li><a href="BreakingNews.html">BreakingNews</a></li><li><a href="BreakingNewsItem.html">BreakingNewsItem</a></li><li><a href="HamburgerButton.html">HamburgerButton</a></li><li><a href="Menu.html">Menu</a></li><li><a href="MenuItem.html">MenuItem</a></li><li><a href="SearchBox.html">SearchBox</a></li></ul></div><div class="category"><h2>Images</h2><h3>Components</h3><ul><li><a href="EagerLoadImages.html">EagerLoadImages</a></li><li><a href="LazyLoadImages.html">LazyLoadImages</a></li><li><a href="ResponsiveHeroImage.html">ResponsiveHeroImage</a></li><li><a href="ResponsiveImage.html">ResponsiveImage</a></li><li><a href="ResponsiveSource.html">ResponsiveSource</a></li></ul></div><div class="category"><h2>Login</h2><h3>Components</h3><ul><li><a href="WithFacebookLogin.html">WithFacebookLogin</a></li><li><a href="WithGoogleLogin.html">WithGoogleLogin</a></li><li><a href="WithLinkedInLogin.html">WithLinkedInLogin</a></li><li><a href="WithMember.html">WithMember</a></li><li><a href="WithSocialLogin.html">WithSocialLogin</a></li><li><a href="WithTwitterLogin.html">WithTwitterLogin</a></li></ul></div><div class="category"><h2>Other</h2><h3>Components</h3><ul><li><a href="ClientSideOnly.html">ClientSideOnly</a></li><li><a href="Link.html">Link</a></li><li><a href="LoadingIndicator.html">LoadingIndicator</a></li><li><a href="SearchPageBase.html">SearchPageBase</a></li><li><a href="UpdateOnInterval.html">UpdateOnInterval</a></li><li><a href="WithClientSideOnly.html">WithClientSideOnly</a></li><li><a href="WithHostUrl.html">WithHostUrl</a></li><li><a href="WithLazy.html">WithLazy</a></li></ul><h3>Global</h3><ul><li><a href="global.html#withError">withError</a></li><li><a href="global.html#WithPreview">WithPreview</a></li></ul></div><div class="category"><h2>Story Page</h2><h3>Components</h3><ul><li><a href="ImageGalleryElement.html">ImageGalleryElement</a></li><li><a href="InfiniteStoryBase.html">InfiniteStoryBase</a></li><li><a href="ReviewRating.html">ReviewRating</a></li><li><a href="SocialShare.html">SocialShare</a></li><li><a href="StoryElement.html">StoryElement</a></li></ul></div><div class="category"><h2>Subscription</h2><h3>Components</h3><ul><li><a href="AccessType.html">AccessType</a></li></ul></div>
                    </nav>
                </div>
            </div>
            <div class="column is-9-desktop">
                <div class="content" id="main-content-wrapper">
                    <header class="page-title">
                        <p>Source</p>
                        <h1>infinite-story-base.js</h1>
                    </header>
                    
                    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React from "react";
import get from "lodash/get";
import { InfiniteScroll } from "./infinite-scroll.js";
import { removeDuplicateStories } from '../utils';

/**
 * This component can be used to implement InfiniteScroll on the story page. You will need to specify the function which renders the story (which will recieve props.index and props.story), and functions for triggering analytics.
 *
 * Example
 * ```javascript
 * import React from 'react';
 *
 * import { BlankStory } from './story-templates';
 * import { InfiniteStoryBase } from '@quintype/components';
 *
 * function StoryPageBase({index, story, otherProp}) {
 *   // Can switch to a different template based story-template, or only show a spoiler if index > 0
 *   return &lt;BlankStory story={story} />
 * }
 *
 * const FIELDS = "id,headline,slug,url,hero-image-s3-key,hero-image-metadata,first-published-at,last-published-at,alternative,published-at,author-name,author-id,sections,story-template,tags,cards";
 * function storyPageLoadItems(pageNumber) {
 *   return global.superagent
 *            .get("/api/v1/stories", {fields: FIELDS, limit:5, offset:5*pageNumber})
 *            .then(response => response.body.stories.map(story => ({story: story, otherProp: "value"})));
 * }
 *
 * export function StoryPage(props) {
 *   return &lt;InfiniteStoryBase {...props}
 *                             render={StoryPageBase}
 *                             loadItems={storyPageLoadItems}
 *                             onItemFocus={(item) => console.log(`Story In View: ${item.story.headline}`)}
 *                             onInitialItemFocus={(item) => console.log(`Do Analytics ${item.story.headline}`)} />
 * }
 *
 * ```
 *
 * #### Not changing the URL on every page
 * When the next story is focussed, the url and title of the page will be set to the next story. If this is not required, it can be disabled by setting the prop doNotChangeUrl={true}.
 * This is typically used when showing the original story, followed by previews of subsequent stories.
 *
 * Example:
 * ```javascript
 *   &lt;InfiniteStoryBase {...props}
 *                      render={StoryPageBase}
 *                      loadItems={storyPageLoadItems}
 *                      onItemFocus={(item) => console.log(`Story In View: ${item.story.headline}`)}
 *                      doNotChangeUrl={true} />
 * ```
 * @component
 * @category Story Page
 */
export class InfiniteStoryBase extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      moreItems: [],
      loading: false,
      pageNumber: 0,
      seenStoryIds: [props.data.story.id]
    }
  }

  allItems() {
    return [this.props.data].concat(this.state.moreItems);
  }

  onFocus(index) {
    const item = this.allItems()[index];

    if(!this.props.doNotChangeUrl) {
      global.app.maybeSetUrl("/" + item.story.slug, get(item, ['story', 'seo', 'meta-title'], item.story.headline));
    }

    this.props.onItemFocus &amp;&amp; this.props.onItemFocus(item, index);

    if(!this.state.seenStoryIds.includes(item.story.id)) {
      this.setState({seenStoryIds: this.state.seenStoryIds.concat([item.story.id])}, () => {
        this.props.onInitialItemFocus &amp;&amp; this.props.onInitialItemFocus(item, index);
      })
    }
  }

  loadMore() {
    if(this.state.loading)
      return;
    const pageNumber = this.state.pageNumber;
    const story = get(this.props.data, ['story'], {});

    this.setState({loading: true, pageNumber: pageNumber + 1}, () => {
      this.props.loadItems(pageNumber, story, this.props.config).then((items) => {
        this.setState({
          loading: false,
          moreItems: this.state.moreItems.concat(removeDuplicateStories(this.allItems(), items, item => item.story.id))
        })
      })
    })
  }

  render() {
    return &lt;InfiniteScroll render={this.props.render}
                           items={this.allItems()}
                           loadNext={() => this.loadMore()}
                           loadMargin={this.props.loadMargin}
                           focusCallbackAt={this.props.focusCallbackAt || 20}
                           onFocus={(index) => this.onFocus(index)}/>
  }
}
</code></pre>
        </article>
    </section>




                </div>
            </div>
        </div>
    </div>

<footer class="footer">
    <div class="content has-text-centered">
        <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.3</a></p>
        <p class="sidebar-created-by">
            <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by 
            <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
        </p>
    </div>
</footer>

<script src="scripts/app.min.js"></script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>



<!DOCTYPE html>
<html lang="en">
<head>
    <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create', 'UA-66074042-1', 'auto');ga('send', 'pageview');</script>
    <meta charset="utf-8">
    <title>JSDoc: components/lazy-load-images.js</title>

    <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="./build/entry.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link href="https://fonts.googleapis.com/css?family=Muli:100,400,700|Oswald:300|Inconsolata,700" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
    <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
    <link type="text/css" rel="stylesheet" href="styles/app.min.css">
    <link type="text/css" rel="stylesheet" href="styles/iframe.css">
    
</head>

<body>
    <div id="stickyNavbarOverlay"></div>
    <div class="top-navbar">
        <div class="container">
            <nav class="navbar" role="navigation" aria-label="main navigation">
                <div class="navbar-brand">
                    
                        <img src="https://images.assettype.com/quintype-website/2018-10/013e8cbe-92b4-435f-bbbb-3e101efbc99a/quintype_logo.png?w=180" alt="logo">
                    
                    
                        <h1 class="navbar-item">@quintype/components</h1>
                    
                    <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
                        <span aria-hidden="true"></span>
                        <span aria-hidden="true"></span>
                        <span aria-hidden="true"></span>
                    </a>
                </div>
                
                <div class="navbar-menu">
                    <div class="navbar-end">
                    
                        <div class="navbar-item">
                            <a href="https://github.com/quintype/quintype-node-components" target="_blank">
                                Github
                            </a>
                        </div>
                    
                    </div>
                </div>
                
            </nav>
        </div>
    </div>
    <div class="container">
        <div class="columns">
            <div class="column is-3" id="sidebarNav">
                <div class="sidebar">
                    <nav>
                        <h2><a href="index.html">Home</a></h2><div class="category"><h3>Tutorials</h3><ul><li><a href="tutorial-using-responsive-image.html">Using ResponsiveImage</a></li></ul><h3>Modules</h3><ul><li><a href="module-Reducers.html">Reducers</a></li></ul></div><div class="category"><h2>Ads</h2><h3>Components</h3><ul><li><a href="AdbutlerAd.html">AdbutlerAd</a></li></ul><h3>Global</h3><ul><li><a href="global.html#createDfpAdComponent">createDfpAdComponent</a></li></ul></div><div class="category"><h2>Collection Page</h2><h3>Components</h3><ul><li><a href="Collection.html">Collection</a></li><li><a href="LazyCollection.html">LazyCollection</a></li><li><a href="LoadMoreCollectionStories.html">LoadMoreCollectionStories</a></li><li><a href="LoadMoreStoriesBase.html">LoadMoreStoriesBase</a></li></ul><h3>Global</h3><ul><li><a href="global.html#collectionToStories">collectionToStories</a></li><li><a href="global.html#wrapCollectionLayout">wrapCollectionLayout</a></li></ul></div><div class="category"><h2>Header</h2><h3>Components</h3><ul><li><a href="BreakingNews.html">BreakingNews</a></li><li><a href="BreakingNewsItem.html">BreakingNewsItem</a></li><li><a href="HamburgerButton.html">HamburgerButton</a></li><li><a href="Menu.html">Menu</a></li><li><a href="MenuItem.html">MenuItem</a></li><li><a href="SearchBox.html">SearchBox</a></li></ul></div><div class="category"><h2>Images</h2><h3>Components</h3><ul><li><a href="EagerLoadImages.html">EagerLoadImages</a></li><li><a href="LazyLoadImages.html">LazyLoadImages</a></li><li><a href="ResponsiveHeroImage.html">ResponsiveHeroImage</a></li><li><a href="ResponsiveImage.html">ResponsiveImage</a></li><li><a href="ResponsiveSource.html">ResponsiveSource</a></li></ul></div><div class="category"><h2>Login</h2><h3>Components</h3><ul><li><a href="WithFacebookLogin.html">WithFacebookLogin</a></li><li><a href="WithGoogleLogin.html">WithGoogleLogin</a></li><li><a href="WithLinkedInLogin.html">WithLinkedInLogin</a></li><li><a href="WithMember.html">WithMember</a></li><li><a href="WithSocialLogin.html">WithSocialLogin</a></li><li><a href="WithTwitterLogin.html">WithTwitterLogin</a></li></ul></div><div class="category"><h2>Other</h2><h3>Components</h3><ul><li><a href="ClientSideOnly.html">ClientSideOnly</a></li><li><a href="Link.html">Link</a></li><li><a href="LinkBase.html">LinkBase</a></li><li><a href="LoadingIndicator.html">LoadingIndicator</a></li><li><a href="SearchPageBase.html">SearchPageBase</a></li><li><a href="UpdateOnInterval.html">UpdateOnInterval</a></li><li><a href="WithClientSideOnly.html">WithClientSideOnly</a></li><li><a href="WithHostUrl.html">WithHostUrl</a></li><li><a href="WithLazy.html">WithLazy</a></li></ul><h3>Global</h3><ul><li><a href="global.html#withError">withError</a></li><li><a href="global.html#WithPreview">WithPreview</a></li></ul></div><div class="category"><h2>Story Page</h2><h3>Components</h3><ul><li><a href="ImageGalleryElement.html">ImageGalleryElement</a></li><li><a href="InfiniteStoryBase.html">InfiniteStoryBase</a></li><li><a href="ReviewRating.html">ReviewRating</a></li><li><a href="SocialShare.html">SocialShare</a></li><li><a href="StoryElement.html">StoryElement</a></li></ul></div><div class="category"><h2>Subscription</h2><h3>Components</h3><ul><li><a href="AccessType.html">AccessType</a></li></ul></div>
                    </nav>
                </div>
            </div>
            <div class="column is-9-desktop">
                <div class="content" id="main-content-wrapper">
                    <header class="page-title">
                        <p>Source</p>
                        <h1>components/lazy-load-images.js</h1>
                    </header>

                    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React from "react";
import {func, string} from 'prop-types';

class IntersectionObserverWrapper {
  constructor(callback) {
    this.observedItems = [];
    this.callback = callback;
  }

  start(margin) {
    this.observer = new global.IntersectionObserver((entries) => this.onObservation(entries), {
      rootMargin: margin,
      threshold: 0,
    });
    this.observedItems.forEach(([dom, component]) => this.observer.observe(dom));
  }

  onObservation(entries) {
    entries
      .filter(entry => {
        return (entry.isIntersecting === undefined || entry.isIntersecting)
      })
      .map(entry => entry.target)
      .forEach(dom => {
        const index = this.observedItems.findIndex(x => x[0] === dom);
        if(index > -1) {
          const component = this.observedItems[index][1];
          this.callback(component);
          this.unregister(dom, component);
        }
      });
  }

  register(dom, component) {
    this.observedItems.push([dom, component]);
    this.observer &amp;&amp; this.observer.observe(dom);
  }

  unregister(dom, component) {
    const index = this.observedItems.findIndex(x => x[0] === dom);

    if (index > -1) {
      this.observedItems.splice(index, 1);
      this.observer &amp;&amp; this.observer.unobserve(dom);
    }
  }

  disconnect() {
    this.observer.disconnect();
  }
}

class StubObserverWrapper {
  constructor(callback) {
    this.callback = callback;
  }

  register(dom, component) {
    this.callback(component);
  }

  start() {}
  unregister() {}
  disconnect() {}
}

/**
 * This component will ensure all {@link ResponsiveImages} that are in its descendent path will be loaded async. By default, the image is loaded with an empty gif, and the image becomes visible when the image scrolls 250 from the edge of the screen.
 *
 * You can use {@link EagerLoadImages} or `eager={true}` to force the image to be eager. If `EagerLoadImages` is passed a predicate, then images that pass a matching value to `eager` will be rendered eagerly.
 *
 * Example
 * ```javascript
 * import { LazyLoadImages, EagerLoadImages } from '@quintype/components';
 *
 * function LazyLoadSecondImage() {
 *   return &lt;div>
 *     &lt;ResponsiveImage slug={props["eager-image-1"]} />
 *     &lt;LazyLoadImages margin={"450px"}>
 *       &lt;div>
 *         &lt;UnrelatedContent/>
 *         &lt;ResponsiveImage slug={props["lazy-image-1"]} />
 *         &lt;ResponsiveImage slug={props["lazy-image-forced-to-be-eager"]} eager/>
 *         &lt;ResponsiveImage slug={props["lazy-image-2"]} />
 *         &lt;EagerLoadImages>
 *           &lt;ResponsiveImage slug={props["lazy-image-forced-to-be-eager"]} />
 *         &lt;/EagerLoadImages>
 *         &lt;EagerLoadImages predicate={(token) => token % 2 === 0}>
 *           &lt;ResponsiveImage slug={props["lazy-image"]} eager={1} />
 *           &lt;ResponsiveImage slug={props["eager-image"]} eager={2} />
 *         &lt;/EagerLoadImages>
 *       &lt;/div>
 *     &lt;/LazyLoadImages>
 *     &lt;ResponsiveImage slug={props["eager-image-2"]} />
 *   &lt;/div>
 * }
 * ```
 * @component
 * @category Images
 */
export class LazyLoadImages extends React.Component {
  constructor(props) {
    super(props);
    const callback = component => component.showImage()
    this.observerWrapper = global.IntersectionObserver ? new IntersectionObserverWrapper(callback) : new StubObserverWrapper(callback);
  }

  componentDidMount() {
    this.observerWrapper.start(this.props.margin || "500px")
  }

  componentWillUnmount() {
    this.observerWrapper.disconnect();
  }

  getChildContext() {
    return {
      lazyLoadObserveImage: (dom, component) => dom &amp;&amp; this.observerWrapper.register(dom, component),
      lazyLoadUnobserveImage: (dom, component) => dom &amp;&amp; this.observerWrapper.unregister(dom, component)
    }
  }

  render() {
    return this.props.children;
  }
}

LazyLoadImages.childContextTypes = {
  lazyLoadObserveImage: func,
  lazyLoadUnobserveImage: func
};

LazyLoadImages.propTypes = {
  margin: string
}
</code></pre>
        </article>
    </section>




                </div>
            </div>
        </div>
    </div>


<footer class="footer">
    <div class="content has-text-centered">
        <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a></p>
        <p class="sidebar-created-by">
            <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by
            <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
        </p>
    </div>
</footer>


<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>

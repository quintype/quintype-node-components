

<!DOCTYPE html>
<html lang="en">

<head>
  <script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create', 'UA-66074042-1', 'auto');ga('send', 'pageview');</script>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> components/story-element.js</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
             
                <a class="image" href="index.html">
                    <img src="https://images.assettype.com/quintype-website/2018-10/013e8cbe-92b4-435f-bbbb-3e101efbc99a/quintype_logo.png?w=180" alt="logo">
                </a>
            
             
                <a href="index.html">
                    <h1 class="navbar-item">@quintype/components</h1>
                </a>
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    API Documentation
                </a>
                
                <div class="dropdown is-hoverable is-right">
                    <a class="dropdown-trigger link">
                        Tutorials
                        <i class="fas fa-chevron-down fa-xs"></i>
                    </a>
                    <div class="dropdown-menu">
                        <div class="dropdown-content">
                        
                            <a class="dropdown-item" href="tutorial-using-responsive-image.html">
                                Using ResponsiveImage
                            </a>
                        
                        </div>
                    </div>
                </div>
                
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            
            <nav>
                
                    <h2><a href="index.html">Documentation</a></h2><div class="category"><h3>Modules</h3><ul><li><a href="module-Reducers.html">Reducers</a></li></ul></div><div class="category"><h2>Ads</h2><h3>Components</h3><ul><li><a href="AdbutlerAd.html">AdbutlerAd</a></li></ul><h3>Global</h3><ul><li><a href="global.html#createDfpAdComponent">createDfpAdComponent</a></li></ul></div><div class="category"><h2>Collection Page</h2><h3>Components</h3><ul><li><a href="Collection.html">Collection</a></li><li><a href="LazyCollection.html">LazyCollection</a></li><li><a href="LoadMoreCollectionStories.html">LoadMoreCollectionStories</a></li><li><a href="LoadMoreStoriesBase.html">LoadMoreStoriesBase</a></li></ul><h3>Global</h3><ul><li><a href="global.html#collectionToStories">collectionToStories</a></li><li><a href="global.html#wrapCollectionLayout">wrapCollectionLayout</a></li></ul></div><div class="category"><h2>Header</h2><h3>Components</h3><ul><li><a href="BreakingNews.html">BreakingNews</a></li><li><a href="BreakingNewsItem.html">BreakingNewsItem</a></li><li><a href="HamburgerButton.html">HamburgerButton</a></li><li><a href="Menu.html">Menu</a></li><li><a href="MenuItem.html">MenuItem</a></li><li><a href="SearchBox.html">SearchBox</a></li></ul></div><div class="category"><h2>Images</h2><h3>Components</h3><ul><li><a href="EagerLoadImages.html">EagerLoadImages</a></li><li><a href="LazyLoadImages.html">LazyLoadImages</a></li><li><a href="ResponsiveHeroImage.html">ResponsiveHeroImage</a></li><li><a href="ResponsiveImage.html">ResponsiveImage</a></li><li><a href="ResponsiveSource.html">ResponsiveSource</a></li></ul></div><div class="category"><h2>Login</h2><h3>Components</h3><ul><li><a href="WithFacebookLogin.html">WithFacebookLogin</a></li><li><a href="WithGoogleLogin.html">WithGoogleLogin</a></li><li><a href="WithLinkedInLogin.html">WithLinkedInLogin</a></li><li><a href="WithMember.html">WithMember</a></li><li><a href="WithSocialLogin.html">WithSocialLogin</a></li><li><a href="WithTwitterLogin.html">WithTwitterLogin</a></li></ul></div><div class="category"><h2>Other</h2><h3>Components</h3><ul><li><a href="ClientSideOnly.html">ClientSideOnly</a></li><li><a href="Link.html">Link</a></li><li><a href="LinkBase.html">LinkBase</a></li><li><a href="LoadingIndicator.html">LoadingIndicator</a></li><li><a href="SearchPageBase.html">SearchPageBase</a></li><li><a href="UpdateOnInterval.html">UpdateOnInterval</a></li><li><a href="WithClientSideOnly.html">WithClientSideOnly</a></li><li><a href="WithHostUrl.html">WithHostUrl</a></li><li><a href="WithLazy.html">WithLazy</a></li></ul><h3>Global</h3><ul><li><a href="global.html#withError">withError</a></li><li><a href="global.html#WithPreview">WithPreview</a></li></ul></div><div class="category"><h2>Story Page</h2><h3>Components</h3><ul><li><a href="ImageGalleryElement.html">ImageGalleryElement</a></li><li><a href="InfiniteStoryBase.html">InfiniteStoryBase</a></li><li><a href="ReviewRating.html">ReviewRating</a></li><li><a href="SocialShare.html">SocialShare</a></li><li><a href="StoryElement.html">StoryElement</a></li></ul></div><div class="category"><h2>Subscription</h2><h3>Components</h3><ul><li><a href="AccessType.html">AccessType</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Source</p>
                    <h1>components/story-element.js</h1>
                </header>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import classNames from "classnames";
import get from "lodash/get";
import React from "react";
import { getQliticsSchema } from "../utils";
import { Link } from "./link";
import { ResponsiveImage } from "./responsive-image";
import StoryElementBrightcove from "./story-elements/brightcove";
import StoryElementDailyMotion from "./story-elements/dailymotion";
import DailyMotionEmbedScript from "./story-elements/dailymotion-embed-script";
import JSEmbed from "./story-elements/jsembed";
import Polltype from "./story-elements/polltype";
import { Table } from "./story-elements/table";
import StoryElementYoutube from "./story-elements/youtube";

/**
 * This component renders different types of [story elements](https://developers.quintype.com/malibu/terminology#story-elements)

 * Qlitics event is fired on story-elements become visible (this can be disabled by passing a prop called `disableAnalytics={true}`)
 *
 * Example
 * ```javascript
 * import { StoryElement } from '@quintype/components';
 * function StoryCard(props){
 *   return &lt;div>
 *     {props.card['story-elements'].map((element, index) => &lt;StoryElement element={element} key={index} story={props.story}>&lt;/StoryElement>)}
 *   &lt;/div>
 * }
 * ```
 * For different quality images in Image Story Element, pass `imageWidths` and `imageDefaultWidth` as props
 * ```javascript
 * &lt;StoryElement story={story} element={element} imageWidths={[420,1040,1600]} imageDefaultWidth={1040}/>
 * ```
 *
 * FIXME: the templates property will allow you to pass in a custom template to override the story elements type.
 *
 * @component
 * @hideconstructor
 * @category Story Page
 */
export class StoryElement extends React.Component {
  constructor(props) {
    super(props);
    this.state = { crashed: false };
  }
  componentDidCatch(error, stack) {
    this.setState({
      crashed: true,
      error: error,
    });
    console &amp;&amp; console.error(`Caught Exception: ${error &amp;&amp; error.message}`);
  }

  render() {
    if (this.state.crashed) {
      return &lt;div className="story-element story-element-crashed" />;
    } else {
      return React.createElement(StoryElementBase, this.props);
    }
  }
}

function StoryElementText({ element = {}, externalLink }) {
  let text = element.text || "";
  if (externalLink) {
    text = element.text.replace(/&lt;a/g, '&lt;a target="_blank"');
  }
  return React.createElement("div", {
    dangerouslySetInnerHTML: { __html: text },
  });
}

function StoryElementAlsoRead({ element, story, alsoreadText = "Also Read: " }) {
  const linkedStories = get(story, ["linked-stories"]);
  const linkedStoryId = get(element, ["metadata", "linked-story-id"]);
  const linkedStorySlug = get(linkedStories, [linkedStoryId, "slug"]);
  const storyUrl = `/${linkedStorySlug}`;
  const linkProps = {
    className: "story-element-text-also-read__link",
    href: storyUrl,
  };

  return React.createElement(
    "h3",
    {},
    React.createElement("span", { className: "story-element-text-also-read__label" }, alsoreadText),
    React.createElement(Link, linkProps, element.text)
  );
}

function StoryElementImage({ element, story = {}, imageWidths, imageDefaultWidth, onClick = () => {} }) {
  return React.createElement(
    "figure",
    {},
    React.createElement(ResponsiveImage, {
      slug: element["image-s3-key"],
      metadata: element["metadata"],
      aspectRatio: null,
      defaultWidth: imageDefaultWidth || 640,
      widths: imageWidths || [360, 640, 1200],
      imgParams: { auto: ["format", "compress"] },
      alt: element.title || story.headline,
      onClick,
    }),
    React.createElement(
      "div",
      { className: "story-element-caption-attribution-wrapper" },
      element.title
        ? React.createElement("figcaption", {
            dangerouslySetInnerHTML: { __html: element.title },
            className: "story-element-image-title",
          })
        : undefined,
      element["image-attribution"]
        ? React.createElement("figcaption", {
            dangerouslySetInnerHTML: { __html: element["image-attribution"] },
            className: "story-element-image-attribution",
          })
        : undefined
    )
  );
}

function StoryElementTitle({ element }) {
  return React.createElement("h2", {}, element.text);
}

function StoryElementSoundCloud({ element }) {
  return React.createElement("iframe", {
    src: element["embed-url"],
    width: "100%",
  });
}

function StoryElementJsembed({ element }) {
  return React.createElement(JSEmbed, {
    embedJS: element["embed-js"],
    id: element["id"],
  });
}

function StoryElementPolltype({ element }) {
  return React.createElement(Polltype, { id: element["polltype-id"] });
}

function StoryElementTable({ element }) {
  return React.createElement(Table, {
    id: element.id,
    data: element.data,
    hasHeader: element.metadata["has-header"],
  });
}

function StoryElementFile({ element }) {
  return React.createElement(
    React.Fragment,
    null,
    React.createElement("div", { className: "story-element-file__title" }, element["file-name"]),
    React.createElement(
      "a",
      {
        className: "story-element-file__link",
        href: element.url,
        download: true,
      },
      "download"
    )
  );
}

// FIXME MISSING: composite
// TODO: Can also support various subtypes (though not needed potentially)

const DEFAULT_TEMPLATES = {
  text: StoryElementText,
  image: StoryElementImage,
  title: StoryElementTitle,
  "dailymotion-video": StoryElementDailyMotion,
  "dailymotion-embed-script": DailyMotionEmbedScript,
  "youtube-video": StoryElementYoutube,
  "soundcloud-audio": StoryElementSoundCloud,
  jsembed: StoryElementJsembed,
  polltype: StoryElementPolltype,
  table: StoryElementTable,
  "also-read": StoryElementAlsoRead,
  file: StoryElementFile,
  "brightcove-video": StoryElementBrightcove,
};

class StoryElementBase extends React.Component {
  constructor(props) {
    super(props);
    this.observer = null;
    this.storyElementRef = null;
  }

  componentDidMount() {
    this.initiateObserver();
  }

  componentWillUnmount() {
    this.destroyObserver();
  }

  initiateObserver = () => {
    if (this.props.disableAnalytics === true) return false;

    const options = {
      root: null,
      rootMargin: "0px",
      threshold: 1.0,
    };
    this.observer = new IntersectionObserver(this.observerCallback, options);
    this.observer.observe(this.storyElementRef);
  };

  destroyObserver = () => {
    this.observer &amp;&amp; this.observer.disconnect();
  };

  observerCallback = (entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        this.emitElementQlitics();
      }
    });
  };

  template() {
    const storyElement = this.props.element;
    const templates = Object.assign({}, DEFAULT_TEMPLATES, this.props.templates);
    return templates[storyElement.subtype] || templates[storyElement.type] || "div";
  }

  emitElementQlitics() {
    const { story = {}, card = {}, element = {} } = this.props;
    if (global.qlitics) {
      global.qlitics("track", "story-element-view", getQliticsSchema(story, card, element));
    } else {
      global.qlitics =
        global.qlitics ||
        function () {
          (qlitics.q = qlitics.q || []).push(arguments);
        };
      global.qlitics("track", "story-element-view", getQliticsSchema(story, card, element));
    }
  }

  storyElement() {
    return this.props.element;
  }

  render() {
    const storyElement = this.props.element;
    const typeClassName = `story-element-${storyElement.type}`;
    const subtypeClassName = `story-element-${storyElement.type}-${storyElement.subtype}`;

    const storyElementTemplate = this.template();

    const { renderTemplates = {}, ...elementProps } = this.props;
    const renderTemplate = renderTemplates[storyElement.subtype] || renderTemplates[storyElement.type];

    return React.createElement(
      "div",
      {
        className: classNames({
          "story-element": true,
          [typeClassName]: true,
          [subtypeClassName]: !!storyElement.subtype,
        }),
        ref: (ref) => (this.storyElementRef = ref),
      },
      renderTemplate
        ? React.createElement(
            renderTemplate,
            { ...elementProps },
            React.createElement(storyElementTemplate, Object.assign({}, elementProps))
          )
        : React.createElement(storyElementTemplate, Object.assign({}, elementProps))
    );
  }
}

export const STORY_ELEMENT_TEMPLATES = DEFAULT_TEMPLATES;
</code></pre>
        </article>
    </section>




            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a></p>
                    <p class="sidebar-created-by">
                        <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by 
                        <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
                    </p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>

</body>
</html>
